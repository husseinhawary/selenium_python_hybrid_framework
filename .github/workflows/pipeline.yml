name: Selenium Python with Allure Report

on:
  push:
    branches:
      - master
  pull_request:
    branches:
      - master

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-python@v3
        with:
          python-version: "3.10"

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      - name: Run tests
        run: pytest -vs --browser=chrome-headless -n 3 --alluredir ./allure-results --clean-alluredir
#      - name: Generate Allure HTML report
#        run: allure generate allure-results

#      - name: Upload Allure HTML report
#        uses: actions/upload-artifact@v3
#        with:
#          name: allure-report-html
#          path: allure-results/index.html
      - name: Upload Allure report
        uses: actions/upload-artifact@v3
        with:
          name: allure-report
          path: allure-results

      - name: Send Results and Generate Allure Report
        uses: Xotabu4/send-to-allure-server-action@1
          # always() needed because we want report for failed tests as well
        if: ${{ always() }}
        with:
          allure-server-url: 'http://my-allure-server.com:5001/'